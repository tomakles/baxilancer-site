<!DOCTYPE html>
<html lang="es-ES">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin />
  <link rel="preconnect" href="https://www.gstatic.com" crossorigin />
  <script src="/assets/lang.js" defer></script>

  <title>App de control de tiempo para freelancers con GPS y esc√°ner de recibos | 3LANCER</title>

  <meta name="description" content="3LANCER es una app de control de tiempo autom√°tica para freelancers y trabajos en campo. Registro por GPS, escaneo de recibos con IA e informes claros para facturaci√≥n e impuestos." />
  <meta name="robots" content="index,follow,max-image-preview:large,max-snippet:-1,max-video-preview:-1" />

  <!-- Canonical URL -->
  <link rel="canonical" href="https://3lancer.ovh/es/" />

  <!-- hreflang ‚Äì all languages -->
  <link rel="alternate" href="https://3lancer.ovh/" hreflang="en" />
  <link rel="alternate" href="https://3lancer.ovh/" hreflang="en-US" />
  <link rel="alternate" href="https://3lancer.ovh/sk/" hreflang="sk" />
  <link rel="alternate" href="https://3lancer.ovh/de/" hreflang="de" />
  <link rel="alternate" href="https://3lancer.ovh/es/" hreflang="es" />
  <link rel="alternate" href="https://3lancer.ovh/pl/" hreflang="pl" />
  <link rel="alternate" href="https://3lancer.ovh/" hreflang="x-default" />

  <!-- Favicon & app icons -->
  <link rel="icon" href="/favicon.ico" sizes="any" />
  <link rel="shortcut icon" href="/favicon.ico" />
  <link rel="icon" type="image/png" sizes="48x48" href="/favicon-48x48.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
  <link rel="icon" type="image/png" sizes="192x192" href="/favicon-192x192.png" />
  <link rel="icon" type="image/png" sizes="256x256" href="/favicon-256x256.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <meta name="msapplication-TileImage" content="/favicon-192x192.png" />
  <meta name="msapplication-TileColor" content="#3D642D" />
  <meta name="theme-color" content="#3D642D" />

  <!-- Open Graph -->
  <meta property="og:title" content="App de control de tiempo para freelancers con GPS y esc√°ner de recibos | 3LANCER" />
  <meta property="og:description" content="Control de tiempo autom√°tico para freelancers y trabajos en campo. GPS, escaneo de recibos con IA e informes por proyecto para facturaci√≥n e impuestos." />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="3LANCER" />
  <meta property="og:url" content="https://3lancer.ovh/es/" />
  <meta property="og:image" content="https://3lancer.ovh/logo.png" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="App de control de tiempo para freelancers con GPS y esc√°ner de recibos | 3LANCER" />
  <meta name="twitter:description" content="Control de tiempo autom√°tico para freelancers y trabajos en campo. GPS, escaneo de recibos con IA e informes por proyecto para facturaci√≥n e impuestos." />
  <meta name="twitter:image" content="https://3lancer.ovh/logo.png" />

  <!-- Structured data: app -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "SoftwareApplication",
    "name": "3LANCER",
    "applicationCategory": "BusinessApplication",
    "operatingSystem": "iOS",
    "description": "App autom√°tica para controlar el tiempo para freelancers con GPS, escaneo de recibos con IA e informes por proyecto.",
    "url": "https://3lancer.ovh/es/",
    "availableLanguage": ["en", "sk", "de", "es", "pl"],
    "offers": {
      "@type": "Offer",
      "priceCurrency": "EUR",
      "description": "Prueba gratis 3 d√≠as y luego suscripci√≥n mensual (precios anunciados en el lanzamiento)."
    },
    "publisher": {
      "@type": "Organization",
      "name": "3LANCER",
      "url": "https://3lancer.ovh/"
    }
  }
  </script>

  <!-- Structured data: organization with logo -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "3LANCER",
    "url": "https://3lancer.ovh/",
    "logo": "https://3lancer.ovh/logo.png",
    "email": "threelancer.customer@gmail.com",
    "sameAs": ["https://instagram.com/3lancer.app"]
  }
  </script>

  <!-- Structured data: FAQ (ES) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [
      {
        "@type": "Question",
        "name": "¬øC√≥mo funciona el control de tiempo autom√°tico por GPS en 3LANCER?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Creas un proyecto y configuras su direcci√≥n. Cuando llegas al lugar, 3LANCER inicia el seguimiento autom√°ticamente seg√∫n tu ubicaci√≥n GPS. Cuando te vas, el temporizador se detiene y las horas quedan guardadas en tu historial."
        }
      },
      {
        "@type": "Question",
        "name": "¬øEs 3LANCER adecuado para oficios y trabajo en campo?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "S√≠. 3LANCER est√° pensado principalmente para t√©cnicos, instaladores y cualquiera que trabaje en las instalaciones del cliente. Ayuda a registrar horas autom√°ticamente y a vincular gastos y recibos a cada proyecto."
        }
      },
      {
        "@type": "Question",
        "name": "¬øPuedo registrar recibos y gastos en 3LANCER?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "3LANCER te permite escanear recibos con IA, asignarlos a proyectos y generar informes claros para facturaci√≥n e impuestos, combinando control de tiempo y control de gastos en una sola herramienta."
        }
      }
    ]
  }
  </script>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-Y7LM47GKKD"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-Y7LM47GKKD');
    window.gtag = gtag;
  </script>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getFirestore } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
    import { collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCVFwLlFKZWhaS4O-9EpDU5yr4YRKruwOQ",
      authDomain: "lancer-watchlist.firebaseapp.com",
      projectId: "lancer-watchlist",
      storageBucket: "lancer-watchlist.appspot.com",
      messagingSenderId: "754434438624",
      appId: "1:754434438624:web:e93f207d2ef5e2838b6785"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    window.firebaseDB = db;
    window.firebaseCollection = collection;
    window.firebaseAddDoc = addDoc;
    window.firebaseServerTimestamp = serverTimestamp;
  </script>

  <style>
    :root {
      --primary-green: #3D642D;
      --primary-green-dark: #304F23;
      --accent-yellow: #F6B600;
      --bg-grey: #F2F3F3;
      --border-grey: #D7D7D7;
      --text-main: #111827;
      --text-muted: #4B5563;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--text-main);
      background: var(--bg-grey);
    }

    header {
      background: #ffffff;
      padding: 24px 20px 48px;
      border-bottom: 1px solid var(--border-grey);
    }

    .header-inner {
      max-width: 960px;
      margin: 0 auto;
      position: relative;
      text-align: center;
    }

    .header-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 16px;
    }

    .brand {
      display: inline-flex;
      align-items: center;
      gap: 24px;
    }

    .logo-icon {
      width: 72px;
      height: 72px;
      border-radius: 12px;
      background: var(--bg-grey);
      object-fit: contain;
    }

    .logo-text {
      font-weight: 800;
      font-size: 36px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--primary-green);
    }

    .logo-text span {
      color: var(--accent-yellow);
    }

    .lang-switcher {
      margin-left: auto;
      display: flex;
      gap: 6px;
      align-items: center;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .lang-link {
      padding: 6px 10px;
      border-radius: 6px;
      border: 1px solid var(--border-grey);
      font-size: 12px;
      background: #ffffff;
      color: var(--text-main);
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 4px;
      font-weight: 500;
      white-space: nowrap;
      transition: all 0.2s ease;
    }

    .lang-link:hover {
      border-color: var(--primary-green);
      color: var(--primary-green);
    }

    .lang-link.active {
      background: var(--primary-green);
      color: #ffffff;
      border-color: var(--primary-green);
    }

    .pill {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 999px;
      background: #ffffff;
      border: 1px solid var(--primary-green);
      color: var(--primary-green);
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      margin-bottom: 8px;
    }

    h1 {
      font-size: 26px;
      margin: 10px 0 10px;
      color: var(--primary-green);
    }

    .subtitle {
      font-size: 17px;
      color: var(--text-muted);
      max-width: 600px;
      margin: 0 auto;
    }

    .btn-primary {
      display: inline-block;
      margin-top: 24px;
      padding: 12px 26px;
      border-radius: 999px;
      background: var(--primary-green);
      color: #ffffff;
      text-decoration: none;
      font-weight: 600;
      font-size: 16px;
      border: none;
      box-shadow: 0 8px 16px rgba(61, 100, 45, 0.25);
      cursor: pointer;
    }

    .btn-primary:hover {
      background: var(--primary-green-dark);
    }

    main {
      max-width: 960px;
      margin: 0 auto;
      padding: 40px 16px 60px;
    }

    h2 {
      font-size: 26px;
      margin-bottom: 16px;
      color: var(--primary-green);
    }

    .section {
      margin-bottom: 40px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 20px;
    }

    .card {
      background: #ffffff;
      border-radius: 16px;
      padding: 0 20px 22px;
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.05);
      border: 1px solid var(--border-grey);
    }

    .card h3 {
      margin: 0 -20px 14px;
      padding: 10px 20px;
      font-size: 16px;
      font-weight: 700;
      background: var(--accent-yellow);
      color: var(--text-main);
      border-radius: 16px 16px 0 0;
      border-bottom: 1px solid var(--border-grey);
    }

    .card p {
      margin: 0;
      color: var(--text-muted);
      font-size: 15px;
      line-height: 1.5;
    }

    .pricing-box {
      background: #ffffff;
      border-radius: 14px;
      padding: 20px;
      border: 1px solid var(--border-grey);
    }

    .pricing-box p {
      margin: 4px 0;
      color: var(--text-main);
    }

    .waitlist-form {
      max-width: 520px;
      width: 100%;
      margin-top: 12px;
    }

    .waitlist-row {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-top: 12px;
    }

    .waitlist-input {
      flex: 1;
      height: 48px;
      padding: 0 26px;
      border-radius: 999px;
      border: 1px solid var(--border-grey);
      font-size: 16px;
      line-height: 48px;
      outline: none;
      background-color: #ffffff;
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      transition: border-color 0.18s ease, box-shadow 0.18s ease, transform 0.06s ease;
    }

    .waitlist-input::placeholder {
      color: #9ca3af;
    }

    .waitlist-input:focus {
      border-color: var(--primary-green);
      box-shadow: 0 0 0 3px rgba(61, 100, 45, 0.18);
      transform: translateY(-1px);
    }

    .waitlist-btn {
      height: 48px;
      padding: 0 26px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      white-space: nowrap;
      margin-top: 0;
    }

    .waitlist-note {
      margin-top: 8px;
      font-size: 13px;
      color: #6b7280;
    }

    @media (max-width: 640px) {
      .waitlist-row {
        flex-direction: column;
        align-items: stretch;
      }

      .waitlist-input {
        width: 100%;
        height: 52px;
        font-size: 16px;
        line-height: 52px;
      }

      .waitlist-btn {
        width: 100%;
        height: 52px;
        text-align: center;
      }
    }

    .muted {
      color: #6b7280;
      font-size: 14px;
    }

    .success-message {
      display: none;
      margin-top: 12px;
      padding: 12px 16px;
      border-radius: 8px;
      background: #d1fae5;
      color: #065f46;
      font-size: 14px;
      text-align: center;
      animation: slideIn 0.3s ease-out;
    }

    .error-message {
      display: none;
      margin-top: 12px;
      padding: 12px 16px;
      border-radius: 8px;
      background: #fee2e2;
      color: #991b1b;
      font-size: 14px;
      text-align: center;
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-8px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    footer {
      text-align: center;
      padding: 24px 16px 32px;
      font-size: 14px;
      color: #6b7280;
      border-top: 1px solid var(--border-grey);
      background: #ffffff;
    }

    @media (max-width: 640px) {
      .header-top {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
        width: 100%;
      }
      .brand {
        gap: 18px;
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: flex-start;
      }
      .logo-icon {
        flex-shrink: 0;
      }
      .logo-text {
        font-size: 44px;
      }
      .lang-switcher {
        margin-left: 0;
        justify-content: flex-end;
        width: 100%;
      }
      .lang-link {
        padding: 5px 8px;
        font-size: 11px;
        gap: 3px;
      }
    }

    @media (min-width: 768px) {
      h1 { font-size: 38px; }
      header { padding-top: 28px; }
    }

    .faq-list {
      background: #ffffff;
      border-radius: 16px;
      padding: 20px;
      border: 1px solid var(--border-grey);
    }

    .faq-item + .faq-item {
      margin-top: 16px;
      padding-top: 12px;
      border-top: 1px dashed var(--border-grey);
    }

    .faq-item h3 {
      margin: 0 0 6px;
      font-size: 16px;
      color: var(--primary-green-dark);
    }

    .faq-item p {
      margin: 0;
      font-size: 14px;
      color: var(--text-muted);
      line-height: 1.5;
    }
  </style>
</head>
<body>

<header>
  <div class="header-inner">
    <div class="header-top">
      <div class="brand">
        <img src="/favicon-192x192.png" alt="3LANCER logo" class="logo-icon" width="72" height="72">
        <div class="logo-text"><span>3</span>LANCER</div>
      </div>

      <div class="lang-switcher">
        <a href="/" class="lang-link">üá¨üáß EN</a>
        <a href="/de/" class="lang-link">üá©üá™ DE</a>
        <a href="/es/" class="lang-link active">üá™üá∏ ES</a>
        <a href="/pl/" class="lang-link">üáµüá± PL</a>
        <a href="/sk/" class="lang-link">üá∏üá∞ SK</a>
      </div>
    </div>

    <div class="hero-copy" style="text-align:center; margin-top:8px;">
      <div class="pill">Para freelancers y aut√≥nomos</div>
      <h1>Control de tiempo con GPS y esc√°ner de recibos</h1>
      <p class="subtitle">
        3LANCER es una app autom√°tica de control de tiempo para freelancers y aut√≥nomos.
        Utiliza tu ubicaci√≥n (GPS) para registrar horas de trabajo y a√±ade escaneo de recibos con IA
        e informes de gastos por proyecto para facturaci√≥n e impuestos.
      </p>
      <a href="#watchlist-form" class="btn-primary">Lanzamiento pronto en App Store</a>
    </div>
  </div>
</header>

<main>
  <section class="section">
    <h2>Qu√© hace 3LANCER por ti</h2>
    <div class="grid">
      <div class="card">
        <h3>üìç Control de tiempo autom√°tico</h3>
        <p>
          Crea un proyecto, asigna una direcci√≥n y m√°rcalo como activo. Cuando est√°s en el lugar,
          el temporizador funciona. Cuando te vas, se detiene y se guarda en tu historial.
        </p>
      </div>
      <div class="card">
        <h3>üßæ Escaneo de recibos y facturas</h3>
        <p>
          Haz una foto de un recibo o factura y la IA extrae los conceptos. As√≠gnalo a un proyecto
          de una vez o concepto por concepto.
        </p>
      </div>
      <div class="card">
        <h3>üìä Informes para facturaci√≥n</h3>
        <p>
          Consulta el tiempo por proyecto, los gastos vinculados y genera res√∫menes listos para
          facturaci√≥n y contabilidad.
        </p>
      </div>
    </div>
  </section>

  <section class="section">
    <h2>¬øPara qui√©n es 3LANCER?</h2>
    <div class="grid">
      <div class="card">
        <h3>üîß Oficios y trabajo en campo</h3>
        <p>
          Construcci√≥n, electricistas, fontaneros, instaladores, t√©cnicos ‚Äì para cualquier trabajo
          en las instalaciones del cliente donde necesitas registrar horas y costes con fiabilidad.
        </p>
      </div>
      <div class="card">
        <h3>üíª Freelancers por hora</h3>
        <p>
          Desarrolladores, consultores IT, dise√±adores, fot√≥grafos, marketing ‚Äì cuando las horas por proyecto
          deben llegar a la factura con precisi√≥n.
        </p>
      </div>
      <div class="card">
        <h3>üë• Peque√±os equipos (pronto)</h3>
        <p>
          Pr√≥ximas versiones permitir√°n registrar tiempo para varias personas en proyectos compartidos,
          con informes combinados y exportaci√≥n de datos.
        </p>
      </div>
    </div>
  </section>

  <!-- Email Watchlist Section -->
  <section class="section">
    <h2>Avisa cuando lancemos</h2>
    <p class="waitlist-desc">
      Deja tu correo y te avisaremos en cuanto 3LANCER est√© disponible en el App Store.
    </p>
    <form id="watchlist-form" class="waitlist-form">
      <div class="waitlist-row">
        <input
          type="email"
          id="watchlist-email"
          class="waitlist-input"
          required
          autocomplete="email"
          placeholder="Tu correo electr√≥nico"
        />
        <button type="submit" class="btn-primary waitlist-btn" id="watchlist-btn">
          Unirme a la lista
        </button>
      </div>
      <p class="waitlist-note">
        Solo usaremos tu correo para enviarte novedades sobre 3LANCER. Sin spam.
      </p>
      <div class="success-message" id="watchlist-success">
        ‚úì ¬°Gracias! Te avisaremos cuando lancemos.
      </div>
      <div class="error-message" id="watchlist-error">
        ‚úó Introduce un correo electr√≥nico v√°lido.
      </div>
    </form>
  </section>

  <section class="section">
    <h2>Precios e idiomas</h2>
    <div class="pricing-box">
      <p>Plataforma: iOS (iPhone)</p>
      <p>Modelo: prueba gratis 3 d√≠as y luego suscripci√≥n mensual.</p>
      <p>Idiomas al lanzamiento: ingl√©s, eslovaco, alem√°n, espa√±ol, polaco.</p>
      <p class="muted">
        Los precios y planes exactos se anunciar√°n en el lanzamiento en el App Store.
      </p>
    </div>
  </section>

  <!-- SEO text section -->
  <section class="section" id="seo-copy">
    <h2>App de control de tiempo con GPS y escaneo de recibos</h2>
    <p>
      3LANCER es una app de control de tiempo pensada para freelancers y aut√≥nomos.
      En lugar de iniciar y detener temporizadores manuales, utiliza tu ubicaci√≥n (GPS) para registrar
      autom√°ticamente las horas por proyecto. Es √∫til para oficios, trabajo en campo y cualquier trabajo por horas.
    </p>
    <p>
      Adem√°s del control de tiempo, 3LANCER tambi√©n sirve para gestionar gastos y recibos.
      Puedes escanear recibos con IA, asignarlos a proyectos y generar informes claros para facturaci√≥n e impuestos.
      El objetivo es unir control de tiempo, escaneo y reporting en una sola herramienta.
    </p>
    <p>
      Si buscas una app autom√°tica de control de tiempo para freelancers, un registro de horas por GPS
      o un esc√°ner de recibos con IA, 3LANCER pretende cubrir todo en un mismo lugar.
    </p>
  </section>

  <!-- FAQ section matching FAQ schema -->
  <section class="section">
    <h2>FAQ: control de tiempo autom√°tico con 3LANCER</h2>
    <div class="faq-list">
      <div class="faq-item">
        <h3>¬øC√≥mo funciona el control de tiempo autom√°tico por GPS en 3LANCER?</h3>
        <p>
          Creas un proyecto y configuras su direcci√≥n. Cuando llegas al lugar, 3LANCER inicia el seguimiento autom√°ticamente
          seg√∫n tu ubicaci√≥n GPS. Cuando te vas, el temporizador se detiene y las horas quedan guardadas en tu historial.
        </p>
      </div>
      <div class="faq-item">
        <h3>¬øEs 3LANCER adecuado para oficios y trabajo en campo?</h3>
        <p>
          S√≠. 3LANCER est√° pensado principalmente para t√©cnicos, instaladores y cualquiera que trabaje en las instalaciones del cliente.
          Ayuda a registrar horas autom√°ticamente y a vincular gastos y recibos a cada proyecto.
        </p>
      </div>
      <div class="faq-item">
        <h3>¬øPuedo registrar recibos y gastos en 3LANCER?</h3>
        <p>
          3LANCER te permite escanear recibos con IA, asignarlos a proyectos y generar informes claros para facturaci√≥n e impuestos,
          combinando control de tiempo y control de gastos en una sola herramienta.
        </p>
      </div>
    </div>
  </section>
</main>

<footer>
  ¬© 2025 3LANCER ‚Ä¢ 3lancer.ovh ‚Ä¢ Contacto: threelancer.customer@gmail.com
</footer>

<script>
  const watchlistForm = document.getElementById('watchlist-form');
  const watchlistEmail = document.getElementById('watchlist-email');
  const successMsg = document.getElementById('watchlist-success');
  const errorMsg = document.getElementById('watchlist-error');

  const ATTR_KEY = '3lancer_attr';
  const ATTR_TTL_MS = 1000 * 60 * 60 * 24 * 30; // 30 days

  function safeLocalStorageGet(key) {
    try {
      return localStorage.getItem(key);
    } catch {
      return null;
    }
  }

  function safeLocalStorageSet(key, value) {
    try {
      localStorage.setItem(key, value);
    } catch {
      // Ignore storage errors (e.g., Safari private mode)
    }
  }

  function getReferrerHost() {
    try {
      return document.referrer ? new URL(document.referrer).hostname : null;
    } catch {
      return null;
    }
  }

  function getAttributionFromUrl() {
    const url = new URL(window.location.href);
    const params = url.searchParams;

    const src = params.get('src');
    const utm = {
      source: params.get('utm_source'),
      medium: params.get('utm_medium'),
      campaign: params.get('utm_campaign'),
      term: params.get('utm_term'),
      content: params.get('utm_content')
    };

    const hasUtm = Object.values(utm).some((v) => typeof v === 'string' && v.length > 0);
    const hasSrc = typeof src === 'string' && src.length > 0;
    if (!hasSrc && !hasUtm) return null;

    return {
      src: hasSrc ? src : null,
      utm,
      savedAt: Date.now()
    };
  }

  function getStoredAttribution() {
    const raw = safeLocalStorageGet(ATTR_KEY);
    if (!raw) return null;
    try {
      const parsed = JSON.parse(raw);
      if (!parsed || typeof parsed !== 'object') return null;
      if (!parsed.savedAt || typeof parsed.savedAt !== 'number') return null;
      if (Date.now() - parsed.savedAt > ATTR_TTL_MS) return null;
      return parsed;
    } catch {
      return null;
    }
  }

  function getSignupContext(lang) {
    const urlAttr = getAttributionFromUrl();
    if (urlAttr) safeLocalStorageSet(ATTR_KEY, JSON.stringify(urlAttr));
    const attr = urlAttr || getStoredAttribution();

    return {
      lang,
      page: window.location.pathname,
      src: attr?.src || null,
      utm: attr?.utm || null,
      referrer: getReferrerHost(),
      userLang: navigator.language || null
    };
  }

  function isValidEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
  }

  watchlistForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const email = watchlistEmail.value.trim();

    successMsg.style.display = 'none';
    errorMsg.style.display = 'none';

    if (!isValidEmail(email)) {
      errorMsg.textContent = '‚úó Introduce un correo electr√≥nico v√°lido.';
      errorMsg.style.display = 'block';
      return;
    }

    try {
      if (window.firebaseDB) {
        const context = getSignupContext('es');
        await window.firebaseAddDoc(window.firebaseCollection(window.firebaseDB, 'watchlist'), {
          email: email,
          timestamp: window.firebaseServerTimestamp(),
          source: 'web-es',
          context
        });
      }
    } catch (firebaseError) {
      console.log('Firebase error, storing locally as fallback:', firebaseError.message);
    }

    const storedEmails = JSON.parse(localStorage.getItem('watchlist') || '[]');
    if (!storedEmails.includes(email)) {
      storedEmails.push(email);
      localStorage.setItem('watchlist', JSON.stringify(storedEmails));
    }

    successMsg.textContent = '‚úì ¬°Gracias! Te avisaremos cuando lancemos.';
    successMsg.style.display = 'block';
    watchlistEmail.value = '';

    if (window.gtag) {
      const context = getSignupContext('es');
      window.gtag('event', 'watchlist_signup', {
        event_category: 'engagement',
        event_label: 'es',
        src: context.src || undefined
      });
    }
  });

  // Basic scroll depth analytics
  let maxScrollSent = 0;
  const scrollMarks = [25, 50, 75, 90];

  window.addEventListener('scroll', () => {
    const doc = document.documentElement;
    const body = document.body;
    const scrollTop = doc.scrollTop || body.scrollTop;
    const scrollHeight = (doc.scrollHeight || body.scrollHeight) - window.innerHeight;
    if (scrollHeight <= 0) return;

    const percent = Math.round((scrollTop / scrollHeight) * 100);
    for (const mark of scrollMarks) {
      if (percent >= mark && maxScrollSent < mark) {
        maxScrollSent = mark;
        if (window.gtag) {
          window.gtag('event', 'scroll_depth', {
            event_category: 'engagement',
            event_label: mark + '%',
            value: mark
          });
        }
      }
    }
  });
</script>

</body>
</html>
