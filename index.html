<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin />
  <link rel="preconnect" href="https://www.gstatic.com" crossorigin />
  <script src="/assets/lang.js" defer></script>
  <link rel="stylesheet" href="/assets/footer.css" />
  <script src="/assets/footer.js" defer></script>

  <title>Freelancer time tracking app with GPS & receipt scanner | 3LANCER</title>

  <meta name="description" content="3LANCER is an automatic time tracking app for freelancers and trades. GPS-based time tracking for on-site jobs, AI receipt scanning and clear reports for invoicing and taxes." />
  <meta name="robots" content="index,follow,max-image-preview:large,max-snippet:-1,max-video-preview:-1" />

  <!-- Canonical URL -->
  <link rel="canonical" href="https://3lancer.ovh/" />

  <!-- hreflang ‚Äì all languages -->
  <link rel="alternate" href="https://3lancer.ovh/" hreflang="en" />
  <link rel="alternate" href="https://3lancer.ovh/" hreflang="en-US" />
  <link rel="alternate" href="https://3lancer.ovh/sk/" hreflang="sk" />
  <link rel="alternate" href="https://3lancer.ovh/de/" hreflang="de" />
  <link rel="alternate" href="https://3lancer.ovh/es/" hreflang="es" />
  <link rel="alternate" href="https://3lancer.ovh/pl/" hreflang="pl" />
  <link rel="alternate" href="https://3lancer.ovh/" hreflang="x-default" />

  <!-- Favicon & app icons -->
  <link rel="icon" href="/favicon.ico" sizes="any" />
  <link rel="shortcut icon" href="/favicon.ico" />
  <link rel="icon" type="image/png" sizes="48x48" href="/favicon-48x48.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
  <link rel="icon" type="image/png" sizes="192x192" href="/favicon-192x192.png" />
  <link rel="icon" type="image/png" sizes="256x256" href="/favicon-256x256.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <meta name="msapplication-TileImage" content="/favicon-192x192.png" />
  <meta name="msapplication-TileColor" content="#3D642D" />
  <meta name="theme-color" content="#3D642D" />

  <!-- Open Graph -->
  <meta property="og:title" content="Freelancer time tracking app with GPS & receipt scanner | 3LANCER" />
  <meta property="og:description" content="Automatic time tracking for freelancers and trades. GPS-based time tracking, AI receipt scanning and project reports for invoicing and taxes." />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="3LANCER" />
  <meta property="og:url" content="https://3lancer.ovh/" />
  <meta property="og:image" content="https://3lancer.ovh/logo.png" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Freelancer time tracking app with GPS & receipt scanner | 3LANCER" />
  <meta name="twitter:description" content="Automatic time tracking for freelancers and trades. GPS-based time tracking, AI receipt scanning and project reports for invoicing and taxes." />
  <meta name="twitter:image" content="https://3lancer.ovh/logo.png" />

  <!-- Structured data: app -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "SoftwareApplication",
    "name": "3LANCER",
    "applicationCategory": "BusinessApplication",
    "operatingSystem": "iOS",
    "description": "Automatic time tracking app for freelancers with GPS-based tracking, AI receipt scanning and project reports.",
    "url": "https://3lancer.ovh/",
    "availableLanguage": ["en", "sk", "de", "es", "pl"],
    "offers": {
      "@type": "Offer",
      "priceCurrency": "EUR",
      "description": "3-day free trial, then monthly subscription (pricing announced at launch in the App Store)."
    },
    "publisher": {
      "@type": "Organization",
      "name": "3LANCER",
      "url": "https://3lancer.ovh/"
    }
  }
  </script>

  <!-- Structured data: organization with logo -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "3LANCER",
    "url": "https://3lancer.ovh/",
    "logo": "https://3lancer.ovh/logo.png",
    "email": "threelancer.customer@gmail.com",
    "sameAs": ["https://instagram.com/3lancer.app"]
  }
  </script>

  <!-- Structured data: FAQ (EN) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [
      {
        "@type": "Question",
        "name": "How does automatic GPS time tracking work in 3LANCER?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "You create a project and set its address. When you arrive on site, 3LANCER automatically starts tracking time based on your GPS location. When you leave, the timer stops and your work hours are saved to your history."
        }
      },
      {
        "@type": "Question",
        "name": "Is 3LANCER suitable for trades and field work?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Yes. 3LANCER is built mainly for trades, installers, technicians and anyone who works on site at the client. It helps track hours automatically and link expenses and receipts to each project."
        }
      },
      {
        "@type": "Question",
        "name": "Can I track receipts and expenses in 3LANCER?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "3LANCER lets you scan receipts with AI, assign them to projects and generate clear reports for invoicing and taxes, combining time tracking and expense tracking in one simple tool."
        }
      }
    ]
  }
  </script>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-Y7LM47GKKD"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-Y7LM47GKKD');
    window.gtag = gtag;
  </script>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { initializeAppCheck, ReCaptchaV3Provider } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app-check.js";
    import { getFirestore, doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCVFwLlFKZWhaS4O-9EpDU5yr4YRKruwOQ",
      authDomain: "lancer-watchlist.firebaseapp.com",
      projectId: "lancer-watchlist",
      storageBucket: "lancer-watchlist.appspot.com",
      messagingSenderId: "754434438624",
      appId: "1:754434438624:web:e93f207d2ef5e2838b6785"
    };

    const app = initializeApp(firebaseConfig);

    const APP_CHECK_SITE_KEY = "";
    if (APP_CHECK_SITE_KEY) {
      try {
        initializeAppCheck(app, {
          provider: new ReCaptchaV3Provider(APP_CHECK_SITE_KEY),
          isTokenAutoRefreshEnabled: true
        });
      } catch (err) {
        console.warn("Firebase App Check init failed:", err);
      }
    }

    const db = getFirestore(app);

    window.firebaseDB = db;
    window.firebaseDoc = doc;
    window.firebaseSetDoc = setDoc;
    window.firebaseServerTimestamp = serverTimestamp;
  </script>

  <style>
    :root {
      --primary-green: #3D642D;
      --primary-green-dark: #304F23;
      --accent-yellow: #F6B600;
      --bg-grey: #F2F3F3;
      --border-grey: #D7D7D7;
      --text-main: #111827;
      --text-muted: #4B5563;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--text-main);
      background: var(--bg-grey);
    }

    header {
      background: #ffffff;
      padding: 24px 20px 48px;
      border-bottom: 1px solid var(--border-grey);
    }

    .header-inner {
      max-width: 960px;
      margin: 0 auto;
      position: relative;
      text-align: center;
    }

    .header-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 16px;
    }

    .brand {
      display: inline-flex;
      align-items: center;
      gap: 24px;
    }

    .logo-icon {
      width: 72px;
      height: 72px;
      border-radius: 12px;
      background: var(--bg-grey);
      object-fit: contain;
    }

    .logo-text {
      font-weight: 800;
      font-size: 36px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--primary-green);
    }

    .logo-text span {
      color: var(--accent-yellow);
    }

    .lang-switcher {
      margin-left: auto;
      display: flex;
      gap: 6px;
      align-items: center;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .lang-link {
      padding: 6px 10px;
      border-radius: 6px;
      border: 1px solid var(--border-grey);
      font-size: 12px;
      background: #ffffff;
      color: var(--text-main);
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 4px;
      font-weight: 500;
      white-space: nowrap;
      transition: all 0.2s ease;
    }

    .lang-link:hover {
      border-color: var(--primary-green);
      color: var(--primary-green);
    }

    .lang-link.active {
      background: var(--primary-green);
      color: #ffffff;
      border-color: var(--primary-green);
    }

    .pill {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 999px;
      background: #ffffff;
      border: 1px solid var(--primary-green);
      color: var(--primary-green);
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      margin-bottom: 8px;
    }

    h1 {
      font-size: 26px;
      margin: 10px 0 10px;
      color: var(--primary-green);
    }

    .subtitle {
      font-size: 17px;
      color: var(--text-muted);
      max-width: 600px;
      margin: 0 auto;
    }

    .btn-primary {
      display: inline-block;
      margin-top: 24px;
      padding: 12px 26px;
      border-radius: 999px;
      background: var(--primary-green);
      color: #ffffff;
      text-decoration: none;
      font-weight: 600;
      font-size: 16px;
      border: none;
      box-shadow: 0 8px 16px rgba(61, 100, 45, 0.25);
      cursor: pointer;
    }

    .btn-primary:hover {
      background: var(--primary-green-dark);
    }

    main {
      max-width: 960px;
      margin: 0 auto;
      padding: 40px 16px 60px;
    }

    h2 {
      font-size: 26px;
      margin-bottom: 16px;
      color: var(--primary-green);
    }

    .section {
      margin-bottom: 40px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 20px;
    }

    .card {
      background: #ffffff;
      border-radius: 16px;
      padding: 0 20px 22px;
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.05);
      border: 1px solid var(--border-grey);
    }

    .card h3 {
      margin: 0 -20px 14px;
      padding: 10px 20px;
      font-size: 16px;
      font-weight: 700;
      background: var(--accent-yellow);
      color: var(--text-main);
      border-radius: 16px 16px 0 0;
      border-bottom: 1px solid var(--border-grey);
    }

    .card p {
      margin: 0;
      color: var(--text-muted);
      font-size: 15px;
      line-height: 1.5;
    }

    .text-link {
      color: var(--primary-green);
      font-weight: 600;
      text-decoration: none;
    }

    .text-link:hover {
      text-decoration: underline;
    }

    .pricing-box {
      background: #ffffff;
      border-radius: 14px;
      padding: 20px;
      border: 1px solid var(--border-grey);
    }

    .pricing-box p {
      margin: 4px 0;
      color: var(--text-main);
    }

    .waitlist-form {
      max-width: 520px;
      width: 100%;
      margin-top: 12px;
    }

    .waitlist-row {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-top: 12px;
    }

    .waitlist-input {
      flex: 1;
      height: 48px;
      padding: 0 26px;
      border-radius: 999px;
      border: 1px solid var(--border-grey);
      font-size: 16px;
      line-height: 48px;
      outline: none;
      background-color: #ffffff;
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      transition: border-color 0.18s ease, box-shadow 0.18s ease, transform 0.06s ease;
    }

    .waitlist-input::placeholder {
      color: #9ca3af;
    }

    .waitlist-input:focus {
      border-color: var(--primary-green);
      box-shadow: 0 0 0 3px rgba(61, 100, 45, 0.18);
      transform: translateY(-1px);
    }

    .waitlist-btn {
      height: 48px;
      padding: 0 26px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      white-space: nowrap;
      margin-top: 0;
    }

    .waitlist-note {
      margin-top: 8px;
      font-size: 13px;
      color: #6b7280;
    }

    @media (max-width: 640px) {
      .waitlist-row {
        flex-direction: column;
        align-items: stretch;
      }

      .waitlist-input {
        width: 100%;
        height: 52px;
        font-size: 16px;
        line-height: 52px;
      }

      .waitlist-btn {
        width: 100%;
        height: 52px;
        text-align: center;
      }
    }

    .muted {
      color: #6b7280;
      font-size: 14px;
    }

    .success-message {
      display: none;
      margin-top: 12px;
      padding: 12px 16px;
      border-radius: 8px;
      background: #d1fae5;
      color: #065f46;
      font-size: 14px;
      text-align: center;
      animation: slideIn 0.3s ease-out;
    }

    .error-message {
      display: none;
      margin-top: 12px;
      padding: 12px 16px;
      border-radius: 8px;
      background: #fee2e2;
      color: #991b1b;
      font-size: 14px;
      text-align: center;
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-8px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    footer {
      text-align: center;
      padding: 24px 16px 32px;
      font-size: 14px;
      color: #6b7280;
      border-top: 1px solid var(--border-grey);
      background: #ffffff;
    }

    footer a {
      color: inherit;
    }

    footer a:hover {
      color: var(--primary-green);
    }

    @media (max-width: 640px) {
      .header-top {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
        width: 100%;
      }
      .brand {
        gap: 18px;
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: flex-start;
      }
      .logo-icon {
        flex-shrink: 0;
      }
      .logo-text {
        font-size: 44px;
      }
      .lang-switcher {
        margin-left: 0;
        justify-content: flex-end;
        width: 100%;
      }
      .lang-link {
        padding: 5px 8px;
        font-size: 11px;
        gap: 3px;
      }
    }

    @media (min-width: 768px) {
      h1 { font-size: 38px; }
      header { padding-top: 28px; }
    }

    .faq-list {
      background: #ffffff;
      border-radius: 16px;
      padding: 20px;
      border: 1px solid var(--border-grey);
    }

    .faq-item + .faq-item {
      margin-top: 16px;
      padding-top: 12px;
      border-top: 1px dashed var(--border-grey);
    }

    .faq-item h3 {
      margin: 0 0 6px;
      font-size: 16px;
      color: var(--primary-green-dark);
    }

    .faq-item p {
      margin: 0;
      font-size: 14px;
      color: var(--text-muted);
      line-height: 1.5;
    }
  </style>
</head>
<body>

<header>
  <div class="header-inner">
    <div class="header-top">
      <div class="brand">
        <img src="/favicon-192x192.png" alt="3LANCER logo" class="logo-icon" width="72" height="72">
        <div class="logo-text"><span>3</span>LANCER</div>
      </div>

      <div class="lang-switcher">
        <a href="/" class="lang-link active">üá¨üáß EN</a>
        <a href="/de/" class="lang-link">üá©üá™ DE</a>
        <a href="/es/" class="lang-link">üá™üá∏ ES</a>
        <a href="/pl/" class="lang-link">üáµüá± PL</a>
        <a href="/sk/" class="lang-link">üá∏üá∞ SK</a>
      </div>
    </div>

      <div class="hero-copy" style="text-align:center; margin-top:8px;">
      <div class="pill">For freelancers & solo contractors</div>
      <h1>Freelancer time tracking app with GPS & receipt scanner</h1>
      <p class="subtitle">
        3LANCER is an automatic time tracking app for freelancers and solo contractors.
        It uses your location (GPS) to log working hours and adds AI receipt scanning and
        project-based expense reports for invoicing and taxes.
      </p>
      <a href="#watchlist-form" class="btn-primary">Launching soon on the App Store</a>
    </div>
  </div>
</header>

<main>
  <section class="section">
    <h2>What 3LANCER does for you</h2>
    <div class="grid">
      <div class="card">
        <h3>üìç Automatic time tracking</h3>
        <p>
          Create a project, set an address and mark it as active. When you are on site,
          the timer runs. When you leave, it stops and logs into your work history.
          <a class="text-link" href="/gps-time-tracking/">Learn more about GPS time tracking</a>.
        </p>
      </div>
      <div class="card">
        <h3>üßæ Receipt & invoice scanning</h3>
        <p>
          Take a photo of a receipt or invoice and AI will parse individual items.
          Assign all at once to one project, or split them item by item.
          <a class="text-link" href="/receipt-scanner/">Learn more about receipt scanning</a>.
        </p>
      </div>
      <div class="card">
        <h3>üìä Reports for billing</h3>
        <p>
          See how much time you spent on each project, which expenses are linked,
          and generate summaries ready for invoicing and accounting.
          <a class="text-link" href="/reports/">Learn more about project reports</a>.
        </p>
      </div>
    </div>
  </section>

  <section class="section">
    <h2>Who is 3LANCER for?</h2>
    <div class="grid">
      <div class="card">
        <h3>üîß Trades & field work</h3>
        <p>
          Construction, electricians, plumbers, installers, service technicians ‚Äì wherever
          you work on site at the client and need to track hours and costs reliably.
        </p>
      </div>
      <div class="card">
        <h3>üíª Freelancers billed by the hour</h3>
        <p>
          Developers, IT consultants, designers, photographers, marketers ‚Äì anywhere
          the hours per project matter and need to end up on invoices accurately.
        </p>
      </div>
      <div class="card">
        <h3>üë• Small teams (coming soon)</h3>
        <p>
          Future versions will allow you to track time for multiple people working on
          shared projects in one company, with combined reports and exportable data.
        </p>
      </div>
    </div>
  </section>

  <!-- Email Watchlist Section -->
  <section class="section">
    <h2>Get notified when we launch</h2>
    <p class="waitlist-desc">
      Leave your email address below and we'll notify you as soon as 3LANCER is
      available in the App Store.
    </p>
    <form id="watchlist-form" class="waitlist-form">
      <div class="waitlist-row">
        <input
          type="email"
          id="watchlist-email"
          class="waitlist-input"
          required
          autocomplete="email"
          placeholder="Your email address"
        />
        <button type="submit" class="btn-primary waitlist-btn" id="watchlist-btn">
          Join the watchlist
        </button>
      </div>
      <p class="waitlist-note">
        We will only use your email to send you updates about 3LANCER. No spam, we promise.
      </p>
      <div class="success-message" id="watchlist-success">
        ‚úì Thank you! We'll notify you when 3LANCER launches.
      </div>
      <div class="error-message" id="watchlist-error">
        ‚úó Please enter a valid email address.
      </div>
    </form>
  </section>

  <section class="section">
    <h2>Pricing & language support</h2>
    <div class="pricing-box">
      <p>Platform: iOS (iPhone)</p>
      <p>Model: 3-day free trial, then monthly subscription.</p>
      <p>App languages at launch: English, Slovak, German, Spanish, Polish.</p>
      <p class="muted">
        Exact pricing tiers and features will be announced at launch in the App Store.
      </p>
    </div>
  </section>

  <!-- SEO text section -->
  <section class="section" id="seo-copy">
    <h2>Freelancer time tracking app with GPS and receipt scanning</h2>
    <p>
      3LANCER is a time tracking app built specifically for freelancers and solo contractors.
      Instead of starting and stopping manual timers, the app uses your location (GPS) to
      automatically track working hours on each project. This makes it useful for trades,
      field work and any kind of hourly freelance work.
    </p>
    <p>
      Besides time tracking, 3LANCER also works as an expense and receipt tracking app.
      You can scan receipts with AI, assign them to projects and generate clear reports
      for invoicing and taxes. The goal is to combine freelancer time tracking, receipt
      scanning and reporting in one simple tool.
    </p>
    <p>
      If you are looking for an automatic time tracking app for freelancers, a GPS-based
      work hours tracker or an AI-powered receipt scanner, 3LANCER aims to cover all of
      these use cases in one place.
    </p>
  </section>

  <!-- FAQ section matching FAQ schema -->
  <section class="section">
    <h2>FAQ: 3LANCER automatic time tracking</h2>
    <div class="faq-list">
      <div class="faq-item">
        <h3>How does automatic GPS time tracking work in 3LANCER?</h3>
        <p>
          You create a project and set its address. When you arrive on site, 3LANCER
          automatically starts tracking time based on your GPS location. When you leave,
          the timer stops and your work hours are saved to your history.
        </p>
      </div>
      <div class="faq-item">
        <h3>Is 3LANCER suitable for trades and field work?</h3>
        <p>
          Yes. 3LANCER is built mainly for trades, installers, technicians and anyone who
          works on site at the client. It helps track hours automatically and link expenses
          and receipts to each project.
        </p>
      </div>
      <div class="faq-item">
        <h3>Can I track receipts and expenses in 3LANCER?</h3>
        <p>
          3LANCER lets you scan receipts with AI, assign them to projects and generate clear
          reports for invoicing and taxes, combining time tracking and expense tracking in one tool.
        </p>
      </div>
    </div>
  </section>
</main>

<footer>
  ¬© 2025 3LANCER ‚Ä¢ <a href="/gps-time-tracking/">GPS</a> ‚Ä¢ <a href="/receipt-scanner/">Receipts</a> ‚Ä¢ <a href="/reports/">Reports</a> ‚Ä¢ <a href="/guides/">Guides</a> ‚Ä¢ <a href="/privacy/">Privacy</a> ‚Ä¢ Contact: <a href="mailto:threelancer.customer@gmail.com">threelancer.customer@gmail.com</a>
</footer>

<script>
  const watchlistForm = document.getElementById('watchlist-form');
  const watchlistEmail = document.getElementById('watchlist-email');
  const successMsg = document.getElementById('watchlist-success');
  const errorMsg = document.getElementById('watchlist-error');

  const ATTR_KEY = '3lancer_attr';
  const ATTR_TTL_MS = 1000 * 60 * 60 * 24 * 30; // 30 days

  function safeLocalStorageGet(key) {
    try {
      return localStorage.getItem(key);
    } catch {
      return null;
    }
  }

  function safeLocalStorageSet(key, value) {
    try {
      localStorage.setItem(key, value);
    } catch {
      // Ignore storage errors (e.g., Safari private mode)
    }
  }

  function getReferrerHost() {
    try {
      return document.referrer ? new URL(document.referrer).hostname : null;
    } catch {
      return null;
    }
  }

  function getAttributionFromUrl() {
    const url = new URL(window.location.href);
    const params = url.searchParams;

    const src = params.get('src');
    const utm = {
      source: params.get('utm_source'),
      medium: params.get('utm_medium'),
      campaign: params.get('utm_campaign'),
      term: params.get('utm_term'),
      content: params.get('utm_content')
    };

    const hasUtm = Object.values(utm).some((v) => typeof v === 'string' && v.length > 0);
    const hasSrc = typeof src === 'string' && src.length > 0;
    if (!hasSrc && !hasUtm) return null;

    return {
      src: hasSrc ? src : null,
      utm,
      savedAt: Date.now()
    };
  }

  function getStoredAttribution() {
    const raw = safeLocalStorageGet(ATTR_KEY);
    if (!raw) return null;
    try {
      const parsed = JSON.parse(raw);
      if (!parsed || typeof parsed !== 'object') return null;
      if (!parsed.savedAt || typeof parsed.savedAt !== 'number') return null;
      if (Date.now() - parsed.savedAt > ATTR_TTL_MS) return null;
      return parsed;
    } catch {
      return null;
    }
  }

  function getSignupContext(lang) {
    const urlAttr = getAttributionFromUrl();
    if (urlAttr) safeLocalStorageSet(ATTR_KEY, JSON.stringify(urlAttr));
    const attr = urlAttr || getStoredAttribution();

    return {
      lang,
      page: window.location.pathname,
      src: attr?.src || null,
      utm: attr?.utm || null,
      referrer: getReferrerHost(),
      userLang: navigator.language || null
    };
  }

  function isValidEmail(email) {
    const emailRegex = /^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$/;
    return emailRegex.test(email);
  }

	  watchlistForm.addEventListener('submit', async (e) => {
	    e.preventDefault();
	    const email = watchlistEmail.value.trim().toLowerCase();

    successMsg.style.display = 'none';
    errorMsg.style.display = 'none';

    if (!isValidEmail(email)) {
      errorMsg.textContent = '‚úó Please enter a valid email address.';
      errorMsg.style.display = 'block';
      return;
    }

	    const context = getSignupContext('en');

	    try {
	      if (window.firebaseDB) {
	        await window.firebaseSetDoc(window.firebaseDoc(window.firebaseDB, 'watchlist', email), {
	          email: email,
	          timestamp: window.firebaseServerTimestamp(),
	          source: 'web-en',
	          context
	        });
	      }
	    } catch (firebaseError) {
	      console.log('Firebase error, storing locally as fallback:', firebaseError.message);
	    }

	    let storedEmails = [];
	    try {
	      storedEmails = JSON.parse(safeLocalStorageGet('watchlist') || '[]');
	      if (!Array.isArray(storedEmails)) storedEmails = [];
	    } catch {
	      storedEmails = [];
	    }
	    storedEmails = storedEmails
	      .filter((item) => typeof item === 'string')
	      .map((item) => item.trim().toLowerCase())
	      .filter(Boolean);
	    if (!storedEmails.includes(email)) {
	      storedEmails.push(email);
	      safeLocalStorageSet('watchlist', JSON.stringify(storedEmails));
	    }

    successMsg.textContent = '‚úì Thank you! We\'ll notify you when 3LANCER launches.';
    successMsg.style.display = 'block';
    watchlistEmail.value = '';

    if (window.gtag) {
      window.gtag('event', 'watchlist_signup', {
        event_category: 'engagement',
        event_label: 'en',
        src: context.src || undefined
      });
    }

    if (window.fbq) {
      window.fbq('track', 'Lead', {
        content_name: 'watchlist_signup',
        language: 'en',
        src: context.src || undefined,
        utm_source: context.utm?.source || undefined,
        utm_medium: context.utm?.medium || undefined,
        utm_campaign: context.utm?.campaign || undefined,
        utm_term: context.utm?.term || undefined,
        utm_content: context.utm?.content || undefined
      });
    }
  });

  // Basic scroll depth analytics
  let maxScrollSent = 0;
  const scrollMarks = [25, 50, 75, 90];

  window.addEventListener('scroll', () => {
    const doc = document.documentElement;
    const body = document.body;
    const scrollTop = doc.scrollTop || body.scrollTop;
    const scrollHeight = (doc.scrollHeight || body.scrollHeight) - window.innerHeight;
    if (scrollHeight <= 0) return;

    const percent = Math.round((scrollTop / scrollHeight) * 100);
    for (const mark of scrollMarks) {
      if (percent >= mark && maxScrollSent < mark) {
        maxScrollSent = mark;
        if (window.gtag) {
          window.gtag('event', 'scroll_depth', {
            event_category: 'engagement',
            event_label: mark + '%',
            value: mark
          });
        }
      }
    }
  });
</script>

</body>
</html>
